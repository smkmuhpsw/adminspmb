<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTable - Mazer Admin Dashboard</title>
    <link rel="icon" href="assets/images/SPMB2.png">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/vendors/simple-datatables/style.css">
    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        .profile-table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        .profile-table th, .profile-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
        }

        .profile-table th {
            background-color: #f8f9fa;
        }

        .profile-section {
            margin-bottom: 40px;
        }

        .profile-title {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
                <div class="sidebar-header">
                    <div class="d-flex justify-content-between">
                        <div class="logo">
                            <a href="home.html"><img src="assets/images/SPMB.png" style="height: 45px;" alt="Logo" srcset=""></a>
                        </div>
                        <div class="toggler">
                            <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                        </div>
                    </div>
                </div>
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">Menu</li>
                        <li class="sidebar-item">
                            <a href="home.html" class='sidebar-link'>
                                <i class="bi bi-grid-fill"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="info.html" class='sidebar-link'>
                                <i class="bi bi-megaphone-fill"></i> 
                                <span>informasi</span>
                            </a>
                        </li>
                        
                        <li class="sidebar-title">Menu Extra</li>
                        <li class="sidebar-item has-sub ">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-stack"></i>
                                <span>Data Master</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item ">
                                    <a href="data-casis.html">Data Casis Offline</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="data-online.html">Data Casis Online</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="jurusan.html">Jurusan</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="tahun.html">Tahun</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="minat.html">Minat Bakat</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="episode.html">Episode</a>
                                </li>
                            </ul>
                        </li>
                        <li class="sidebar-item has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-hexagon-fill"></i>
                                <span>Pembayaran</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="data-pem-ppdb.html">Pembayaran Casis</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="riwayat.html">Riwayat</a>
                                </li>
                                
                            </ul>
                        </li>
                        <li class="sidebar-item has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-pen-fill"></i>
                                <span>Laporan</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="laporan_jurusan.html">Data Jumlah Casis</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="laporan-eps.html">Laporan Kuota</a>
                                </li>
                            </ul>
                        </li>
                        <li class="sidebar-item">
                            <a href="pengaturan.html" class='sidebar-link'>
                                <i class="bi bi-gear-fill"></i>
                                <span>Pengaturan</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="javascript:void(0);" class="sidebar-link" onclick="logout()">
                            <i class="bi bi-grid-1x2-fill"></i>
                                <span>Logout</span>
                            </a>
                        </li>
                       
                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>Data Casis</h3>
                            <p class="text-subtitle text-muted">Calon Siswa</p>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">DataTable</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
                <section class="section">
                    <div class="card">
                        <div class="card-body">
                            <h2 class="profile-title">Profil Calon Siswa</h2>

                            <div class="profile-section">
                                <h4>Data Siswa</h4>
                                <table class="profile-table">
                                    <tbody>
                                        <tr>
                                            <td class="profile-label">ID Pendaftaran</td>
                                            <td id="profile-id" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Nama</td>
                                            <td id="profile-nama" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Jenis Kelamin</td>
                                            <td id="profile-jenis-kelamin" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Tempat, Tanggal Lahir</td>
                                            <td id="profile-ttl" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Agama</td>
                                            <td id="profile-agama" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Jurusan Yang Dipilih 1</td>
                                            <td id="profile-jurusan1" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Jurusan Yang Dipilih 2</td>
                                            <td id="profile-jurusan2" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Ekskul</td>
                                            <td id="profile-ekskul" class="profile-value"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="profile-section">
                                <h4>Data SMP</h4>
                                <table class="profile-table">
                                    <tbody>
                                        <tr>
                                            <td class="profile-label">Asal SMP</td>
                                            <td id="profile-asal-smp" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Lulusan Tahun</td>
                                            <td id="profile-lulusan-tahun" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">No Ijazah</td>
                                            <td id="profile-no-ijazah" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">NISN</td>
                                            <td id="profile-nisn" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Jumlah Nilai SKHU</td>
                                            <td id="profile-nilai-skhu" class="profile-value"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="profile-section">
                                <h4>Data Keluarga</h4>
                                <table class="profile-table">
                                    <tbody>
                                        <tr>
                                            <td class="profile-label">Alamat Calon Siswa</td>
                                            <td id="profile-alamat-siswa" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Kode Pos</td>
                                            <td id="profile-kode-pos" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Telepon</td>
                                            <td id="profile-telepon" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Nama Ayah</td>
                                            <td id="profile-ayah" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Nama Ibu</td>
                                            <td id="profile-ibu" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Alamat Orang Tua</td>
                                            <td id="profile-alamat-ortu" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">No HP Siswa</td>
                                            <td id="profile-hp-siswa" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">No HP Orang Tua</td>
                                            <td id="profile-hp-ortu" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Pekerjaan Orang Tua</td>
                                            <td id="profile-pekerjaan-ortu" class="profile-value"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="profile-section">
                                <h4>Data Panitia</h4>
                                <table class="profile-table">
                                    <tbody>
                                        <tr>
                                            <td class="profile-label">Panitia Yang Input</td>
                                            <td id="profile-panitia" class="profile-value"></td>
                                        </tr>
                                        <tr>
                                            <td class="profile-label">Yang Membawa</td>
                                            <td id="profile-yang-membawa" class="profile-value"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <footer>
            <div class="footer clearfix mb-0 text-muted">
                <div class="float-start">
                    <p>2025 &copy; AGA</p>
                </div>
                <div class="float-end">
                    <p>By <a
                            href="">Sewu Developer</a></p>
                </div>
            </div>
        </footer>
        <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
        <script src="assets/js/bootstrap.bundle.min.js"></script>

        <script>
            // Check if the user is logged in
            if (!localStorage.getItem('username')) {
                window.location.href = 'index.html'; // Redirect to login page
            }
        
            // Prevent user from going back to the previous page
            window.history.replaceState(null, '', window.location.href);
            window.onpopstate = function () {
                window.history.go(1);
            };
        
             // Get the username from localStorage
        const username = localStorage.getItem('username') || 'test_user';
        document.getElementById('usernameHeader').textContent = username;
        
        </script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwed1SZl95wqluCYQo28q__CsuOzHMkIvya-jg1tjH-9lYY_AyKOeKHgeATRGpeGbLF/exec';
        const scripton  = 'https://script.google.com/macros/s/AKfycbzFDBY5JYjevG8wNd4-9zQSBtVR3pmNuuVqiDv6r8zKmtkBZjLWmo4VcWDpp1Y4kHIksQ/exec';
        const jurusanURL = 'https://script.google.com/macros/s/AKfycby8DTNLIpo1Bi8_SGpQ_Xm1mLzGAsc7jwtaPxHEPNdP5n_hx8L8rq8vSdbrWBYUeaUH/exec'; 
        const ekskulURL  = 'https://script.google.com/macros/s/AKfycbyuVEJDxX9l7i5gkHE83TjAb5LaAOeWf9d3ffIkHc1X4mHWLr3B9IwpYmEMB9lEKCa9/exec';
    
        let allData = [];
        let jurusanMap = {};
        let ekskulMap = {};
    
        function getIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id_pendaftaran')?.trim();
        }
    
        function getCorrectAPI(idPendaftaran) {
            return idPendaftaran.startsWith('ONSMK') ? scripton : scriptURL;
        }
    
        function fetchData() {
            const idPendaftaran = getIdFromUrl();
            if (!idPendaftaran) {
                alert('ID Pendaftaran tidak ditemukan di URL.');
                return;
            }
    
            const selectedAPI = getCorrectAPI(idPendaftaran);
            console.log('Fetching data for ID Pendaftaran:', idPendaftaran, 'using API:', selectedAPI);
    
            fetch(`${selectedAPI}?id_pendaftaran=${encodeURIComponent(idPendaftaran)}`)
                .then(res => res.json())
                .then(profileData => {
                    if (!profileData || profileData.message === 'Data not found') {
                        console.log('Data tidak ditemukan:', profileData);
                        alert('Data tidak ditemukan untuk ID Pendaftaran ini.');
                        return;
                    }
                    allData = [profileData];
                    return Promise.all([
                        fetch(jurusanURL).then(res => res.json()),
                        fetch(ekskulURL).then(res => res.json())
                    ]);
                })
                .then(([jurusanData, ekskulData]) => {
                    if (jurusanData) {
                        jurusanMap = jurusanData.reduce((map, jurusan) => {
                            map[jurusan.id_jurusan] = jurusan.jurusan;
                            return map;
                        }, {});
                    }
                    if (ekskulData) {
                        ekskulMap = ekskulData.reduce((map, ekskul) => {
                            map[ekskul.id_minat] = ekskul.minat;
                            return map;
                        }, {});
                    }
                    displayProfile();
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }
    
        function displayProfile() {
            const idPendaftaran = getIdFromUrl();
            const profileData = allData.find(row => row.Id_Pendaftaran === idPendaftaran);
    
            if (!profileData) {
                alert('Data tidak ditemukan untuk ID Pendaftaran ini.');
                return;
            }
    
            const jurusan1Name = jurusanMap[profileData.jurusan_1] || 'Tidak Diketahui';
            const jurusan2Name = jurusanMap[profileData.jurusan_2] || 'Tidak Diketahui';
            const ekskulName = ekskulMap[profileData.Ekskul] || 'Tidak Diketahui';
    
            document.getElementById('profile-id').textContent = profileData.Id_Pendaftaran || 'N/A';
            document.getElementById('profile-nama').textContent = profileData.Nama || 'N/A';
            document.getElementById('profile-jenis-kelamin').textContent = profileData.Jenis_Kelamin || 'N/A';
            document.getElementById('profile-ttl').textContent = `${profileData.Tempat_Lahir || 'N/A'}, ${profileData.Tanggal_Lahir ? new Date(profileData.Tanggal_Lahir).toLocaleDateString('id-ID') : 'N/A'}`;
            document.getElementById('profile-agama').textContent = profileData.Agama || 'N/A';
            document.getElementById('profile-asal-smp').textContent = profileData.Asal_Smp || 'N/A';
            document.getElementById('profile-lulusan-tahun').textContent = profileData.Lulusan_Tahun || 'N/A';
            document.getElementById('profile-no-ijazah').textContent = profileData.No_Ijazah || 'N/A';
            document.getElementById('profile-nisn').textContent = profileData.NISN || 'N/A';
            document.getElementById('profile-nilai-skhu').textContent = profileData.Jumlah_Nilai_skhu || 'N/A';
            document.getElementById('profile-alamat-siswa').textContent = profileData.Alamat_Calon_Siswa || 'N/A';
            document.getElementById('profile-kode-pos').textContent = profileData.Kode_posta || 'N/A';
            document.getElementById('profile-telepon').textContent = profileData.telp || 'N/A';
            document.getElementById('profile-ayah').textContent = profileData.ayah || 'N/A';
            document.getElementById('profile-ibu').textContent = profileData.ibu || 'N/A';
            document.getElementById('profile-alamat-ortu').textContent = profileData.alamat_ortu || 'N/A';
            document.getElementById('profile-hp-siswa').textContent = profileData.no_siswa || 'N/A';
            document.getElementById('profile-hp-ortu').textContent = profileData.no_ortu || 'N/A';
            document.getElementById('profile-pekerjaan-ortu').textContent = profileData.pekerjaan_ortu || 'N/A';
            document.getElementById('profile-jurusan1').textContent = jurusan1Name || 'N/A';
            document.getElementById('profile-jurusan2').textContent = jurusan2Name || 'N/A';
            document.getElementById('profile-ekskul').textContent = ekskulName || 'N/A';
            document.getElementById('profile-panitia').textContent = profileData.panitia_input || 'N/A';
            document.getElementById('profile-yang-membawa').textContent = profileData.yang_membawa || 'N/A';
    
            document.getElementById('profile-container').style.display = 'block';
        }
    
        fetchData();
    });
    
    </script>
    <script>
        function logout() {
            const username = localStorage.getItem('username'); // Get the username from local storage
    
            // Check if username exists
            if (username) {
                const deleteUrl = `https://script.google.com/macros/s/AKfycbxAeeQSHUDj_k1pX-z3k9KG0d17QwWmIe0s7-Er7mljIWNah3umEcROWc7mRKtVQveJ/exec?username=${encodeURIComponent(username)}&action=delete`; // Replace with your actual Google Apps Script URL
    
                fetch(deleteUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Data deleted successfully:', data);
                        // Clear the history from local storage
                        localStorage.removeItem('history');
                        localStorage.removeItem('username');
                        localStorage.removeItem('password');
                        localStorage.removeItem('role');
    
                        // Redirect to index.html
                        window.location.href = 'index.html'; // Change 'index.html' to your actual homepage if different
                    })
                    .catch(error => {
                        console.error('Error deleting data:', error);
                        // Optionally, clear local storage and redirect even if deletion fails
                        localStorage.removeItem('history');
                        localStorage.removeItem('username');
                        localStorage.removeItem('password');
                        localStorage.removeItem('role');
                        window.location.href = 'index.html';
                    });
            } else {
                // If no username is found, just redirect
                localStorage.removeItem('history');
                        localStorage.removeItem('username');
                        localStorage.removeItem('password');
                        localStorage.removeItem('role');
                window.location.href = 'index.html';
            }
        }
    </script>
        <script src="assets/js/main.js"></script>
    </div>
</body>

</html>