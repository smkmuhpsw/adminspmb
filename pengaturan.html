<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIM SPMB - Pengaturan</title>
    <link rel="icon" href="assets/images/SPMB2.png">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">

    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon">
</head>

<body>
    <div id="app">
        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
                <div class="sidebar-header">
                    <div class="d-flex justify-content-between">
                        <div class="logo">
                            <a href="home.html"><img src="assets/images/SPMB.png" style="height: 45px;" alt="Logo" srcset=""></a>
                        </div>
                        <div class="toggler">
                            <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                        </div>
                    </div>
                </div>
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">Menu</li>
                        <li class="sidebar-item">
                            <a href="home.html" class='sidebar-link'>
                                <i class="bi bi-grid-fill"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="info.html" class='sidebar-link'>
                                <i class="bi bi-megaphone-fill"></i> 
                                <span>informasi</span>
                            </a>
                        </li>
                        
                        <li class="sidebar-title">Menu Extra</li>
                        <li class="sidebar-item has-sub ">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-stack"></i>
                                <span>Data Master</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item ">
                                    <a href="data-casis.html">Data Casis Offline</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="data-online.html">Data Casis Online</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="jurusan.html">Jurusan</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="tahun.html">Tahun</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="minat.html">Minat Bakat</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="episode.html">Episode</a>
                                </li>
                            </ul>
                        </li>
                        <li class="sidebar-item has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-hexagon-fill"></i>
                                <span>Pembayaran</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="data-pem-ppdb.html">Pembayaran Casis</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="riwayat.html">Riwayat</a>
                                </li>
                                
                            </ul>
                        </li>
                        <li class="sidebar-item has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-pen-fill"></i>
                                <span>Laporan</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="laporan_jurusan.html">Data Jumlah Casis</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="laporan-eps.html">Laporan Kuota</a>
                                </li>
                            </ul>
                        </li>
                        <li class="sidebar-item active">
                            <a href="pengaturan.html" class='sidebar-link'>
                                <i class="bi bi-gear-fill"></i>
                                <span>Pengaturan</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="javascript:void(0);" class="sidebar-link" onclick="logout()">
                            <i class="bi bi-grid-1x2-fill"></i>
                                <span>Logout</span>
                            </a>
                        </li>
                       
                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>Pengaturan Aplikasi</h3>
                            <p class="text-subtitle text-muted">halaman pengaturan aplikasi</p>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Form Layout</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>

                <div class="my-alert d-none alert alert-success" role="alert">
                    Form submitted successfully!
                </div>
                <div class="my-alert d-none alert alert-danger" role="alert">
                    Id ini sudah melakukan transajsi pembayaran!
                </div>

                <!-- // Basic multiple Column Form section start -->
                <section id="multiple-column-form">
                    <div class="row match-height">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-content">
                                    <div class="card-body">
                                        <form class="form" name="editform" id="editform">
                                            <div class="row">
                                                <h4 class="card-title p-3">Data Sekolah</h4>
                                                <div class="col-md-6 ">
                                                    <div class="form-group">
                                                        <label for="nama_casis">Nama Aplikasi</label>
                                                        <input type="text" id="nama_apk" class="form-control" name="nama_apk" >
                                                    </div>
                                                </div>
                                                <div class="col-md-6 ">
                                                    <div class="form-group">
                                                        <label for="nama_casis">Sekolah</label>
                                                        <input type="text" id="sekolah" class="form-control" name="sekolah" >
                                                    </div>
                                                </div>
                                                <div class="col-md-6 ">
                                                    <div class="form-group">
                                                        <label for="nama_casis">NPSN</label>
                                                        <input type="text" id="npsn" class="form-control" name="npsn" >
                                                    </div>
                                                </div>
                                                <div class="col-md-6 ">
                                                    <div class="form-group">
                                                        <label for="nama_casis">Tahun Ajaran</label>
                                                        <input type="text" id="tahun" class="form-control" name="tahun" >
                                                    </div>
                                                </div>
                                                
                                                <h4 class="card-title p-3">Pengaturan Detail</h4>
                                                <div class="col-md-6 col-12">
                                                    <div class="form-group">
                                                        <label for="asal_smp">No Telpon</label>
                                                        <input type="text" id="no_telp" class="form-control" name="no_telp">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-12">
                                                    <div class="form-group">
                                                        <label for="tahun_l">Email</label>
                                                        <input type="email" id="email" class="form-control" name="email">
                                                    </div>
                                                </div>
                                                
                                                
                                                <div class="col-12 ">
                                                    <div class="form-group">
                                                        <label for="no_ijazah">alamat</label>
                                                        <textarea class="form-control" id="alamat" name="alamat"
                                                        rows="3"></textarea>
                                                    </div>
                                                </div>
                                                <h4 class="card-title p-3">Pengaturan pembayaran</h4>
                                                <div class="col-md-12 col-12">
                                                  <div class="form-group">
                                                      <label for="tahun_l">tanda jadi</label>
                                                      <input type="number" id="tanda_jadi" class="form-control" name="tanda_jadi" >
                                                  </div>
                                              </div>
                                              <div class="col-md-12 col-12">
                                                  <div class="form-group">
                                                      <label for="tahun_l">Id pengaturan</label>
                                                      <input type="text" id="id_peng" class="form-control" name="id_peng" >
                                                  </div>
                                              </div>
                                                <br>
                                                <div class="col-12 d-flex justify-content-end">
                                                    <button type="submit" class="btn btn-primary me-1 mb-1 btn-kirim">Submit</button>
                                                        <button class="btn btn-primary btn-loading d-none" type="button" disabled>
                                                            <span class="spinner-grow spinner-grow-sm" aria-hidden="true"></span>
                                                            <span role="status">Loading...</span>
                                                          </button>
                                                    <button type="reset"class="btn btn-light-secondary me-1 mb-1">Reset</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- // Basic multiple Column Form section end -->
            </div>

            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>2025 &copy; AGA</p>
                    </div>
                    <div class="float-end">
                        <p>By <a
                                href="">Sewu Developer</a></p>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/main.js"></script>
</body>
<script>
    // Check if the user is logged in
    if (!localStorage.getItem('username')) {
        window.location.href = 'index.html'; // Redirect to login page
    }

    // Prevent user from going back to the previous page
    window.history.replaceState(null, '', window.location.href);
    window.onpopstate = function () {
        window.history.go(1);
    };

     // Get the username from localStorage
const username = localStorage.getItem('username') || 'test_user';
document.getElementById('usernameHeader').textContent = username;

</script>
<script>
    function fetchData() {
        const url = 'https://script.google.com/macros/s/AKfycby0LYbdFXB5nsn_Mpp_37SQFADKmUANn07PQEl6XsxJiWV3nzIvqZOdN-hjNmdz3KO5/exec'; // Ganti dengan URL dari Google Apps Script
        fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log("Data dari Spreadsheet:", data);
            
            // Ambil nilai "Yang Harus Dibayar" dari data (misalnya dari entri pertama)
            if (data.length > 0) {
                    document.getElementById('id_peng').value = data[0].id_peng;
                    document.getElementById('nama_apk').value = data[0].nama_apk;
                    document.getElementById('sekolah').value = data[0].sekolah;
                    document.getElementById('npsn').value = data[0].npsn;
                    document.getElementById('tahun').value = data[0].tahun;
                    document.getElementById('no_telp').value = data[0].no_telp;
                    document.getElementById('email').value = data[0].email;
                    document.getElementById('alamat').value = data[0].alamat;
                document.getElementById('tanda_jadi').value = data[0].bayar;
            }
        })
        .catch(error => console.error('Error fetching data:', error));
    }
    
    // Panggil fungsi saat halaman dimuat
    document.addEventListener('DOMContentLoaded', fetchData);
    
</script>
<script>
          document.addEventListener('DOMContentLoaded', () => {
              document.getElementById('editform').addEventListener('submit', function(event) {
                  event.preventDefault(); // Prevent default form submission
      
                  const url = 'https://script.google.com/macros/s/AKfycbyyT-8c-9ML9a3qid3fgv-cmo8EBV7qKRVkSWEV3K15-_U7R5NEAVG_PcIsZuseO0c/exec'; // Replace with your Google Apps Script URL
                  const params = {
                      func: 'UPDATE',
                      data: {
                              id_peng: document.getElementById('id_peng').value, // ID sebagai kunci utama
                              nama_apk: document.getElementById('nama_apk').value,
                              sekolah: document.getElementById('sekolah').value,
                              npsn: document.getElementById('npsn').value,
                              tahun: document.getElementById('tahun').value,
                              no_telp: document.getElementById('no_telp').value,
                              email: document.getElementById('email').value,
                              alamat: document.getElementById('alamat').value,
                              pembayaran: document.getElementById('tanda_jadi').value
                         
                      },
                      SH: 'pengaturan' // Replace with your actual sheet name if necessary
                  };
      
                  fetch(url, {
                      method: 'POST',
                      mode:"no-cors",
                      headers: {
                          'Content-Type': 'application/json'
                      },
                      body: JSON.stringify(params)
                  })
                  .then(() => {
                      alert("Berhasil: Data berhasil diupdate."); // Display success message
                      // Refresh the page after update
                      location.reload(); // Refresh the current page
                  })
                  .catch(error => {
                      console.error('Error updating entry:', error);
                      alert(' An error occurred while trying to update the entry.');
                  });
              });
          });
      </script>

      <script>
        function logout() {
            const username = localStorage.getItem('username'); // Get the username from local storage
    
            // Check if username exists
            if (username) {
                const deleteUrl = `https://script.google.com/macros/s/AKfycbxAeeQSHUDj_k1pX-z3k9KG0d17QwWmIe0s7-Er7mljIWNah3umEcROWc7mRKtVQveJ/exec?username=${encodeURIComponent(username)}&action=delete`; // Replace with your actual Google Apps Script URL
    
                fetch(deleteUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Data deleted successfully:', data);
                        // Clear the history from local storage
                        localStorage.removeItem('history');
                        localStorage.removeItem('username');
                        localStorage.removeItem('password');
                        localStorage.removeItem('role');
    
                        // Redirect to index.html
                        window.location.href = 'index.html'; // Change 'index.html' to your actual homepage if different
                    })
                    .catch(error => {
                        console.error('Error deleting data:', error);
                        // Optionally, clear local storage and redirect even if deletion fails
                        localStorage.removeItem('history');
                        localStorage.removeItem('username');
                        localStorage.removeItem('password');
                        localStorage.removeItem('role');
                        window.location.href = 'index.html';
                    });
            } else {
                // If no username is found, just redirect
                localStorage.removeItem('history');
                        localStorage.removeItem('username');
                        localStorage.removeItem('password');
                        localStorage.removeItem('role');
                window.location.href = 'index.html';
            }
        }
    </script>
</html>